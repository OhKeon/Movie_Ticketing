<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Member Page</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="../static/css/mypage1.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    nav ul li{display: inline-block;}
    ul,li{list-style-type:none;}
    nav ul ul{display: none; background: #1f2937}
    nav ul li:hover ul{display:block; position:absolute;}
    nav ul ul li{width:100px; height:30px;}
  </style>

</head>
<body class="bg-gray-100">
<nav id="navbar" class="bg-gray-800 p-2 mt-0 w-full">
  <div class="container mx-auto flex justify-between">
    <div class="text-white font-bold text-2xl">
      <a href="/">CINE</a>
    </div>
    <div class="flex mt-2">
      <ul>
        <li>
          <a href="movie.html" class="text-gray-200 text-sm hover:text-white mr-4">영화</a>
        </li>
        <li>
          <a href="reservation.html" class="text-gray-200 text-sm hover:text-white mr-4">예매</a>
        </li>
        <li>
          <a href="logout" class="text-gray-200 text-sm hover:text-white mr-4">로그아웃</a>
        </li>
        <li>
          <a href="#" class="text-gray-200 text-sm hover:text-white">마이페이지</a>
          <ul>
            <li><a href = '#' class="text-gray-150 text -sm  hover:text-white">내 정보변경</a></li>
            <li><a href = 'mypage2' class = "text-gray-150 text -sm  hover:text-white">예매 조회 </a></li>
          </ul>

        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="flex h-screen">

  <!-- Modify Member Information Section -->
  <div class="w-1/2 flex flex-col items-center justify-center bg-white p-8">
    <a href="mypag2">예매내역 조회</a>
    <h1 class="text-xl font-bold mb-8">회원정보변경</h1>

    <form action="update-password" method="post" id="modifyForm" class="w-full max-w-lg">
      <div class="flex flex-wrap -mx-3 mb-6">
        <div class="w-full px-3">
          <label for="name" class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2">이름</label>
          <input type="text" th:value ="${member.name}" name="name" id="name" value="name" readonly class="block w-full bg-gray-200 border rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white" />
        </div>
      </div>
      <div class="flex flex-wrap -mx-3 mb-6">
        <div class="w-full px-3">
          <label for="age" class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2">나이</label>
          <input type="number" th:value ="${member.age}" name="age" id="age" value="20" readonly class="block w-full bg-gray-200 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" />
        </div>
      </div>
      <div class="flex flex-wrap -mx-3 mb-6">
        <div class="w-full px-3">
          <label for="email" class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2">이메일</label>
          <input type="email" th:value ="${member.email}" name="email" id="email" value="john@example.com" readonly class="block w-full bg-gray-200 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" />
        </div>
      </div>
      <div class="flex flex-wrap -mx-3 mb-6">
        <div class="w-full px-3">
          <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="password">
            새 비밀번호
          </label>
          <input name="password" class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" id="password" type="password" placeholder="******************">
        </div>
      </div>
      <div class="flex flex-wrap -mx-3 mb-6">
        <div class="w-full px-3">
          <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="password-confirm">
            비밀번호 확인
          </label>
          <input class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" id="password-confirm" type="password" placeholder="******************">
        </div>
      </div>
      <div class="flex items-center justify-between">
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button" onclick="checkPassword()">
          변경
        </button>
      </div>
    </form>
  </div>

  <!-- Membership Withdrawal Section -->
  <div class="w-1/2 flex flex-col items-center justify-center bg-gray-50 p-8">
    <h1 class="text-xl font-bold mb-8">회원탈퇴</h1>

    <div class="w-full max-w-xs">
    <form action="/delete-member" method="post">
      <div class="mb-4">

        <label class="block text-gray-700 text-sm font-bold mb-2" >
          비밀번호
        </label>
        <input name="password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="password-withdrawal" type="password" placeholder="******************">
      </div>
      <div class="flex items-center justify-between">
        <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
          탈퇴
        </button>  -->
        <!--- fetch 함수 이용해서 alert만드는 거인데 일단 보류
        <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button" onclick="withdrawMembership()">
          탈퇴
        </button>  -->

      </div>
    </form>
    </div>

  </div>
</div>

<script>
  function checkPassword() {
    const password = document.getElementById('password').value;
    const confirm = document.getElementById('password-confirm').value;

    if (password === confirm) {
      alert('비밀번호 변경 완료');
      document.getElementById('modifyForm').submit(); // 폼 제출
    } else {
      alert('비밀번호가 서로 다릅니다');
    }
  }

  function withdrawMembership() {
    const password = document.getElementById('password-withdrawal').value;
    // 비밀번호가 입력되었는지 확인
    if (!password) {
      alert('비밀번호를 입력하세요.');
      return;
    }
/* 잘 안됨 보류
    // 비밀번호를 서버에 전송하여 회원 탈퇴 시도
    //fetch함수를 통해서 redirection을 처리하기에 서버에서 반환한 return "redirect:/logout"
    //이런 코드가 직접적으로 코드에 영향을 미치지 않음 어렵노
    fetch('/delete-member', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: `password=${password}`
    })      //fetch url에서 만약 redirect가 됐으면
            .then(response => { // response redirect 동작해서 알림울림
              if (response.redirected) {
                if(response.url == "/mypage1") {
                 alert("비밀번호가 일치하지 않습니다.")
                  window.location.href = response.url;
                }else {
                  // 회원 탈퇴가 성공한 경우
                  alert('회원탈퇴가 완료되었습니다.');
                  window.location.href = response.url;
                  //postMapping을 통해서 받은 return url을 사용
                }
              }
            })
            .catch(error => {
              console.error('Error:', error);
            });

 */


  }
</script>

</body>
</html>